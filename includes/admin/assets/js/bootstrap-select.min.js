
/* 
 Created by : Hassan Tafreshi
 Copy right owner : whiteStudio.team
 Desc: This multi-select is designed base on boostrap 5 and used for Easy form builder Wordpress Plugin
 */

 let idOfMenu_efb ="";
 let default_val_efb ="Select an Option";
 let inputSearch_efb;
 let ArrSearch_efb = Array.prototype;

 /* temp code for test  */
 function TempFun(){
     const dataSetId = "menu-1" // in id ke mikhahim khoroji begirm inja pass dadeh shavad
     const l = document.querySelector(`[data-id="${dataSetId}"].efb.efblist.inplist`)
     let s = l.dataset.select.split(',');
     s= s.slice(0,(s.length-1))
     let r =''
     s.forEach(element => {
         const d = document.querySelector(`.efb.table.${dataSetId}`)
         let v= d.querySelector(`[data-row="${element}"]`)
         r += v.dataset.name +', '
     });
     r=r.slice(0,(r.length-2));
     console.log(r);
 }
  /* End  temp code for test  */

 function onInputEventEFB(e) {
     inputSearch_efb = e;    
     var table1 = document.querySelector(`.${e.dataset.id}.table` );
        ArrSearch_efb.forEach.call(table1.tBodies, function(tbody) {
             ArrSearch_efb.forEach.call(tbody.rows, filterTable_efb);
         });
 }
 
 function filterTable_efb(row) {
     var text = row.textContent.toLowerCase();
    var val = inputSearch_efb.value.toLowerCase();
   row.style.display = text.indexOf(val) === -1 ? 'none' : 'table-row';
 }
 
 
 function FunSearchTableEfb(dataSetId){
     let inputs =document.querySelector(`[data-id="${dataSetId}"].searchBox` );
      onInputEventEFB(inputs)
 }
 
  document.addEventListener("click", (evnt) => {
      const d=evnt.target.dataset.id;
      if(evnt.target.classList.contains('efblist')){
          if(idOfMenu_efb!=d){
              if(idOfMenu_efb.length>1){
                 c_m_efb();
              }else{
                 idOfMenu_efb =d;
                 a_m_efb();
              }
          }else{
              if(evnt.target.dataset.parent){
                 c_m_efb();
              }
          }
         
      }else if (evnt.target.tagName=="TD" ||evnt.target.tagName=="TH"  ){
          
       const e =evnt.target.parentNode 
         if(e.classList.contains('efblist')){
             let l =  document.querySelector(`[data-id="${idOfMenu_efb}"]`);
             if(l.dataset.no==1){
                 let fc = e.querySelector("TH")
                 if(e.dataset.row ==l.dataset.select){
                     l.dataset.select="" ;
                     l.innerHTML=default_val_efb;
                    if (l.dataset.icon==1) fc.className="bi-square";
                 }else{
                 
                     if(l.dataset.select.length>0) {
                         let x= document.querySelector(`[data-id="${idOfMenu_efb}"] [data-row="${l.dataset.select}"]`);
                         x.querySelector("TH").className="bi-square";                    
                     }
                     l.dataset.select=e.dataset.row;
                     l.innerHTML=e.dataset.name;
 
                     if (l.dataset.icon==1) fc.className="bi-check-square text-info";
                     e.className += " border-info";
                 }
                 c_m_efb();
             }else{

                 const r= e.dataset.row;
                 let fc = e.querySelector("TH")
                 if(l.dataset.select.includes(r)){

                     l.dataset.select= l.dataset.select.replace(`${r},`, '');
                     const v= l.innerHTML.length == (l.innerHTML.indexOf(',')+1) ? default_val_efb :''
                     l.innerHTML =  l.innerHTML.replace(`${e.dataset.name},`,v);
                     if (l.dataset.icon==1) fc.className="bi-square";
                     e.className="efblist"
                 }else{
                    const s= l.dataset.select.split(",");
                     if((s.length)<=l.dataset.no){
                         if (l.dataset.icon==1) fc.className="bi-check-square text-info";
                         l.dataset.select.length<1 ?  l.innerHTML=e.dataset.name+"," :l.innerHTML+=e.dataset.name+","
                         l.dataset.select+=`${e.dataset.row},`;
                         e.className += " border-info";
 
                     }

                 }
           
             }          
         }else{
             if(idOfMenu_efb.length>1){
                 c_m_efb();
             }
         }
      }else if (idOfMenu_efb!=""){
         c_m_efb();
      }
  });
 
  const c_m_efb=()=>{
     //hide the list select
        let m = document.querySelector(`[data-list="${idOfMenu_efb}"]`);        
        m.classList.add("d-none");
        idOfMenu_efb="";
       }
   const a_m_efb=()=>{
       //Show the list select
        let m = document.querySelector(`[data-list="${idOfMenu_efb}"]`);
        m.classList.remove("d-none");
       }
 
 